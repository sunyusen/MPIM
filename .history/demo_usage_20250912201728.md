# MPIM åŠŸèƒ½æ¼”ç¤ºæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å¯åŠ¨ä¾èµ–æœåŠ¡
# ZooKeeper (ç«¯å£ 2181)
# Redis (ç«¯å£ 6379)  
# MySQL (ç«¯å£ 3306)

# åˆå§‹åŒ–æ•°æ®åº“
mysql -u root -p < sql/init_database.sql
```

### 2. å¯åŠ¨ç³»ç»Ÿ
```bash
cd /home/glf/MPIM
./bin/start.sh
```

### 3. è¿æ¥å®¢æˆ·ç«¯
```bash
# å¯åŠ¨å®¢æˆ·ç«¯
./bin/client 127.0.0.1 9000
```

## ğŸ“‹ åŠŸèƒ½æ¼”ç¤º

### åŸºç¡€åŠŸèƒ½
```bash
# 1. æ³¨å†Œç”¨æˆ·
register alice 123456
register bob 123456

# 2. ç™»å½•
login alice 123456

# 3. å‘é€æ¶ˆæ¯
chat 2 Hello Bob!
chat @2 How are you?

# 4. æ‹‰å–ç¦»çº¿æ¶ˆæ¯
pull

# 5. ç™»å‡º
logout
```

### å¥½å‹åŠŸèƒ½
```bash
# 1. ç™»å½•
login alice 123456

# 2. æ·»åŠ å¥½å‹
addfriend 2

# 3. æŸ¥çœ‹å¥½å‹åˆ—è¡¨
getfriends

# 4. ä¸å¥½å‹èŠå¤©
chat 2 Hello friend!
```

### ç¾¤ç»„åŠŸèƒ½
```bash
# 1. ç™»å½•
login alice 123456

# 2. åˆ›å»ºç¾¤ç»„
creategroup æµ‹è¯•ç¾¤ç»„ è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç¾¤ç»„

# 3. åŠ å…¥ç¾¤ç»„ (éœ€è¦å¦ä¸€ä¸ªç”¨æˆ·)
login bob 123456
joingroup 1

# 4. å‘é€ç¾¤ç»„æ¶ˆæ¯
sendgroup 1 Hello everyone!

# 5. æŸ¥çœ‹ç¾¤ç»„æ¶ˆæ¯
pull
```

## ğŸ¯ å‘½ä»¤å‚è€ƒ

### ç”¨æˆ·ç®¡ç†
- `register <username> <password>` - æ³¨å†Œç”¨æˆ·
- `login <username> <password>` - ç™»å½•
- `logout` - ç™»å‡º

### æ¶ˆæ¯åŠŸèƒ½
- `chat <user_id> <message>` - å‘é€ç§èŠæ¶ˆæ¯
- `chat @<user_id> <message>` - å‘é€ç§èŠæ¶ˆæ¯ï¼ˆ@æ ¼å¼ï¼‰
- `pull` - æ‹‰å–ç¦»çº¿æ¶ˆæ¯

### å¥½å‹åŠŸèƒ½
- `addfriend <friend_id>` - æ·»åŠ å¥½å‹
- `getfriends` - è·å–å¥½å‹åˆ—è¡¨

### ç¾¤ç»„åŠŸèƒ½
- `creategroup <name> <description>` - åˆ›å»ºç¾¤ç»„
- `joingroup <group_id>` - åŠ å…¥ç¾¤ç»„
- `sendgroup <group_id> <message>` - å‘é€ç¾¤ç»„æ¶ˆæ¯

### ç³»ç»Ÿå‘½ä»¤
- `help` - æ˜¾ç¤ºå¸®åŠ©
- `quit` - é€€å‡ºå®¢æˆ·ç«¯

## ğŸ”§ æ¶æ„è¯´æ˜

### æœåŠ¡ç«¯å£
- **im-gateway**: 9000 (TCPç½‘å…³)
- **im-userd**: 8010 (ç”¨æˆ·æœåŠ¡)
- **im-presenced**: 8012 (åœ¨çº¿çŠ¶æ€æœåŠ¡)
- **im-messaged**: 8011 (æ¶ˆæ¯æœåŠ¡)
- **im-groupd**: 8013 (ç¾¤ç»„æœåŠ¡)

### æ•°æ®å­˜å‚¨
- **MySQL**: ç”¨æˆ·æ•°æ®ã€å¥½å‹å…³ç³»ã€ç¾¤ç»„ä¿¡æ¯ã€ç¦»çº¿æ¶ˆæ¯
- **Redis**: åœ¨çº¿è·¯ç”±ã€æ¶ˆæ¯æŠ•é€’

### æœåŠ¡å‘ç°
- **ZooKeeper**: æœåŠ¡æ³¨å†Œä¸å‘ç°

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **è¿æ¥å¤±è´¥**: æ£€æŸ¥ç½‘å…³æ˜¯å¦å¯åŠ¨ (ç«¯å£ 9000)
2. **RPC è°ƒç”¨å¤±è´¥**: æ£€æŸ¥å„æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
3. **æ•°æ®åº“é”™è¯¯**: æ£€æŸ¥ MySQL è¿æ¥å’Œè¡¨ç»“æ„
4. **Redis é”™è¯¯**: æ£€æŸ¥ Redis æœåŠ¡çŠ¶æ€

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
tail -f bin/logs/*.log

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
tail -f bin/logs/im-gateway.log
tail -f bin/logs/im-userd.log
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### åŸºå‡†æµ‹è¯•
```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•
./bin/rpc_roundtrip_bench
./bin/e2e_latency_bench
./bin/gateway_e2e_bench
```

### å‹åŠ›æµ‹è¯•
```bash
# å¤šå®¢æˆ·ç«¯å¹¶å‘æµ‹è¯•
for i in {1..10}; do
    ./bin/client 127.0.0.1 9000 &
done
```
