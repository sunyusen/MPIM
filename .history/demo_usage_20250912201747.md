# MPIM 功能演示指南

## 🚀 快速开始

### 1. 环境准备
```bash
# 启动依赖服务
# ZooKeeper (端口 2181)
# Redis (端口 6379)  
# MySQL (端口 3306)

# 初始化数据库
mysql -u root -p < sql/init_database.sql
```

### 2. 启动系统
```bash
cd /home/glf/MPIM
./bin/start.sh
```

### 3. 连接客户端
```bash
# 启动客户端
./bin/client 127.0.0.1 9000
```

## 📋 功能演示

### 基础功能
```bash
# 1. 注册用户
register alice 123456
register bob 123456

# 2. 登录
login alice 123456

# 3. 发送消息
chat 2 Hello Bob!
chat @2 How are you?

# 4. 拉取离线消息
pull

# 5. 登出
logout
```

### 好友功能
```bash
# 1. 登录
login alice 123456

# 2. 添加好友
addfriend 2

# 3. 查看好友列表
getfriends

# 4. 与好友聊天
chat 2 Hello friend!
```

### 群组功能
```bash
# 1. 登录
login alice 123456

# 2. 创建群组
creategroup 测试群组 这是一个测试群组

# 3. 加入群组 (需要另一个用户)
login bob 123456
joingroup 1

# 4. 发送群组消息
sendgroup 1 Hello everyone!

# 5. 查看群组消息
pull
```

## 🎯 命令参考

### 用户管理
- `register <username> <password>` - 注册用户
- `login <username> <password>` - 登录
- `logout` - 登出

### 消息功能
- `chat <user_id> <message>` - 发送私聊消息
- `chat @<user_id> <message>` - 发送私聊消息（@格式）
- `pull` - 拉取离线消息

### 好友功能
- `addfriend <friend_id>` - 添加好友
- `getfriends` - 获取好友列表

### 群组功能
- `creategroup <name> <description>` - 创建群组
- `joingroup <group_id>` - 加入群组
- `sendgroup <group_id> <message>` - 发送群组消息

### 系统命令
- `help` - 显示帮助
- `quit` - 退出客户端

## 🔧 架构说明

### 服务端口
- **im-gateway**: 9000 (TCP网关)
- **im-userd**: 8010 (用户服务)
- **im-presenced**: 8012 (在线状态服务)
- **im-messaged**: 8011 (消息服务)
- **im-groupd**: 8013 (群组服务)

### 数据存储
- **MySQL**: 用户数据、好友关系、群组信息、离线消息
- **Redis**: 在线路由、消息投递

### 服务发现
- **ZooKeeper**: 服务注册与发现

## 🐛 故障排除

### 常见问题
1. **连接失败**: 检查网关是否启动 (端口 9000)
2. **RPC 调用失败**: 检查各服务是否正常启动
3. **数据库错误**: 检查 MySQL 连接和表结构
4. **Redis 错误**: 检查 Redis 服务状态

### 日志查看
```bash
# 查看所有服务日志
tail -f bin/logs/*.log

# 查看特定服务日志
tail -f bin/logs/im-gateway.log
tail -f bin/logs/im-userd.log
```

## 📊 性能测试

### 基准测试
```bash
# 运行性能测试
./bin/rpc_roundtrip_bench
./bin/e2e_latency_bench
./bin/gateway_e2e_bench
```

### 压力测试
```bash
# 多客户端并发测试
for i in {1..10}; do
    ./bin/client 127.0.0.1 9000 &
done
```
